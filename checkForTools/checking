#!/bin/bash

# Author: Zakaria Farahi & Saad lili & Sohaib
# Created: 7 May 2024
# Last Modified: 10 May 2024

# Description:
# Check if the Tools will be used is already installed if not try to install it

# Usage:
# sudo ./checking -y

helping() {
	echo "Usage: $0 [options]"
	echo "Options:"
	echo "  -h, --help     Display this help message"
	echo "  -i, --install  Allow Program to install missing tools"
}

install=0

if [ "$(id -u)" -eq 0 ]; then
    SUDO=""
else
    SUDO="sudo"
fi

# Options
if [[ "$1" == "-h" || "$1" == "--help" ]]; then
	helping
	exit 0
elif [[ "$1" == "-i" || "$1" == "--install" ]]; then
	install=1
fi

# Check if user is Root
if [ "$EUID" -ne 0 ]; then
	echo "This script must be run with sudo."
	exit 1
fi

# Testing and installing
# whois
if ! command -v whois &>/dev/null; then
	echo "whois is not installed."
	if [[ "$install" == 0 ]]; then
		read -p "Do you want to install it? (y / n) : " accepted
	fi
	if [[ "$accepted" == "y" || "$install" == 1 ]]; then
		$SUDO apt install -y whois >/dev/null
	else
		echo "Installation cancelled."
	fi
else
	echo "whois is already installed"
fi

# nslookup
if ! command -v nslookup &>/dev/null; then
	echo "nslookup is not installed."
	if [[ "$install" == 0 ]]; then
		read -p "Do you want to install it? (y / n) : " accepted
	fi
	if [[ "$accepted" == "y" || "$install" == 1 ]]; then
		$SUDO apt install -y dnsutils >/dev/null
	else
		echo "Installation cancelled."
	fi
else
	echo "nslookup is already installed"
fi

# amass
if ! command -v amass &>/dev/null; then
	echo "amass is not installed."
	if [[ "$install" == 0 ]]; then
		read -p "Do you want to install it? (y / n) : " accepted
	fi
	if [[ "$accepted" == "y" || "$install" == 1 ]]; then
		# check for golang dont try to install it
		if ! command -v go &>/dev/null; then
			echo "golang is not installed."
			if [[ "$install" == 0 ]]; then
				read -p "Do you want to install it? (y / n) : " accepted
			fi
			if [[ "$accepted" == "y" || "$install" == 1 ]]; then
				$SUDO add-apt-repository ppa:longsleep/golang-backports >/dev/null
				$SUDO apt update >/dev/null
				$SUDO apt install golang-go >/dev/null
			else
				echo "Installation cancelled."
			fi
			# exit 1
		fi
		# install amass
		go install -v github.com/owasp-amass/amass/v4/...@master >/dev/null
		cd $HOME/go/bin
		$SUDO cp amass /usr/bin
	else
		echo "Installation cancelled."
	fi
else
	echo "amass is already installed"
fi

# subfinder
if ! command -v subfinder &>/dev/null; then
	echo "subfinder is not installed."
	if [[ "$install" == 0 ]]; then
		read -p "Do you want to install it? (y / n) : " accepted
	fi
	if [[ "$accepted" == "y" || "$install" == 1 ]]; then
		# check for golang dont try to install it
		if ! command -v go &>/dev/null; then
			echo "golang is not installed."
			if [[ "$install" == 0 ]]; then
				read -p "Do you want to install it? (y / n) : " accepted
			fi
			if [[ "$accepted" == "y" || "$install" == 1 ]]; then
				$SUDO add-apt-repository ppa:longsleep/golang-backports >/dev/null
				$SUDO apt update >/dev/null
				$SUDO apt install golang-go >/dev/null
			else
				echo "Installation cancelled."
			fi
			# exit 1
		fi
		# install subfinder
		go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest >/dev/null
		cd $HOME/go/bin
		$SUDO cp subfinder /usr/bin
	else
		echo "Installation cancelled."
	fi
else
	echo "subfinder is already installed"
fi

# sublist3r
if ! command -v sublist3r &>/dev/null; then
	echo "sublist3r is not installed."
	if [[ "$install" == 0 ]]; then
		read -p "Do you want to install it? (y / n) : " accepted
	fi
	if [[ "$accepted" == "y" || "$install" == 1 ]]; then
		# check for python3 dont try to install it
		if ! command -v python3 &>/dev/null; then
			echo "python3 is not installed."
			echo "Please install python3 first."
			exit
		fi
		# install sublist3r
		git clone https://github.com/aboul3la/Sublist3r.git >/dev/null
		$SUDO mv Sublist3r/ /opt/
		cd /opt/Sublist3r/
		# Create a virtual environment
		$SUDO apt update >/dev/null
		apt install python3-venv >/dev/null
		python3 -m venv venv >/dev/null
		source venv/bin/activate
		# Install the requirements
		# Check if pip is installed ?
		if command -v pip >/dev/null 2>&1; then
			echo "pip is installed, proceeding with installation of requirements"
			pip install -r requirements.txt >/dev/null
		else
			echo "pip is not installed, we will install it now"
			# Install pip
			$SUDO apt update >/dev/null
			$SUDO apt install -y python3-pip >/dev/null
			# Check if pip installation was successful
			if [ $? -eq 0 ]; then
				echo "pip installation successful, proceeding with installation of requirements"
				pip install -r requirements.txt >/dev/null
			else
				echo "pip installation failed, please install pip manually and then run 'pip install -r requirements.txt'"
				exit 1
			fi
		fi
		touch sublist3r
		echo "#!/bin/bash" >>sublist3r
		echo "python3 /opt/Sublist3r/sublist3r.py \$*" >>sublist3r
		chmod +x sublist3r
		$SUDO mv sublist3r /usr/bin/
	else
		echo "Installation cancelled."
	fi
else
	echo "sublist3r is already installed"
fi

# Scrapy
if ! scrapy --version >/dev/null 2>&1; then
	echo "Scrapy is not installed."
	read -p "Do you want to install it? (y / n) : " accepted
	if [[ "$accepted" == "y" ]]; then
		pip install scrapy >/dev/null
		if [ $? -eq 0 ]; then
			echo "Scrapy has been installed."
		else
			echo "Scrapy installation failed."
			exit 1
		fi
		# setup_scrapy_project
	else
		echo "Installation cancelled."
		exit 1
	fi
else
	echo "Scrapy is already installed."
	# setup_scrapy_project
fi

# nmap
if ! command -v nmap &>/dev/null; then
	echo "nmap is not installed."
	if [[ "$install" == 0 ]]; then
		read -p "Do you want to install it? (y / n) : " accepted
	fi
	if [[ "$accepted" == "y" || "$install" == 1 ]]; then
		$SUDO apt install -y nmap >/dev/null
	else
		echo "Installation cancelled."
	fi
else
	echo "nmap is already installed"
fi

# masscan
if ! command -v masscan &>/dev/null; then
	echo "masscan is not installed."
	if [[ "$install" == 0 ]]; then
		read -p "Do you want to install it? (y / n) : " accepted
	fi
	if [[ "$accepted" == "y" || "$install" == 1 ]]; then
		$SUDO apt install -y masscan >/dev/null
	else
		echo "Installation cancelled."
	fi
else
	echo "masscan is already installed"
fi

# httpx
if ! command -v httpx &>/dev/null; then
	echo "httpx is not installed."
	if [[ "$install" == 0 ]]; then
		read -p "Do you want to install it? (y / n) : " accepted
	fi
	if [[ "$accepted" == "y" || "$install" == 1 ]]; then
		# check for golang dont try to install it
		if ! command -v go &>/dev/null; then
			echo "golang is not installed."
			if [[ "$install" == 0 ]]; then
				read -p "Do you want to install it? (y / n) : " accepted
			fi
			if [[ "$accepted" == "y" || "$install" == 1 ]]; then
				$SUDO add-apt-repository ppa:longsleep/golang-backports >/dev/null
				$SUDO apt update >/dev/null
				$SUDO apt install golang-go >/dev/null
			else
				echo "Installation cancelled."
			fi
			# exit 1
		fi
		# install httpx
		go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest >/dev/null
		cd $HOME/go/bin
		$SUDO cp httpx /usr/bin
	else
		echo "Installation cancelled."
	fi
else
	echo "httpx is already installed"
fi

# ffuf
if ! command -v ffuf &>/dev/null; then
	echo "ffuf is not installed."
	if [[ "$install" == 0 ]]; then
		read -p "Do you want to install it? (y / n) : " accepted
	fi
	if [[ "$accepted" == "y" || "$install" == 1 ]]; then
		# check for golang dont try to install it
		if ! command -v go &>/dev/null; then
			echo "golang is not installed."
			if [[ "$install" == 0 ]]; then
				read -p "Do you want to install it? (y / n) : " accepted
			fi
			if [[ "$accepted" == "y" || "$install" == 1 ]]; then
				$SUDO add-apt-repository ppa:longsleep/golang-backports >/dev/null
				$SUDO apt update >/dev/null
				$SUDO apt install golang-go >/dev/null
			else
				echo "Installation cancelled."
			fi
			# exit 1
		fi
		# install ffuf
		go install -v github.com/ffuf/ffuf@latest >/dev/null
		cd $HOME/go/bin
		$SUDO cp ffuf /usr/bin
	else
		echo "Installation cancelled."
	fi
else
	echo "ffuf is already installed"
fi

# dirsearch
if ! command -v dirsearch &>/dev/null; then
	echo "dirsearch is not installed."
	if [[ "$install" == 0 ]]; then
		read -p "Do you want to install it? (y / n) : " accepted
	fi
	if [[ "$accepted" == "y" || "$install" == 1 ]]; then
		# check for python3 dont try to install it
		if ! command -v python3 &>/dev/null; then
			echo "python3 is not installed."
			echo "Please install python3 first."
			exit
		fi
		# install dirsearch
		git clone https://github.com/maurosoria/dirsearch.git >/dev/null
		$SUDO mv dirsearch/ /opt/
		cd /opt/dirsearch/
		# Create a virtual environment
		$SUDO apt update >/dev/null
		apt install python3-venv >/dev/null
		python3 -m venv venv >/dev/null
		source venv/bin/activate
		# Install the requirements
		# Check if pip is installed ?
		if command -v pip3 >/dev/null 2>&1; then
			echo "pip is installed, proceeding with installation of requirements"
			pip install -r requirements.txt >/dev/null
		else
			echo "pip is not installed, we will install it now"
			# Install pip
			$SUDO apt update >/dev/null
			$SUDO apt install -y python3-pip >/dev/null
			# Check if pip installation was successful
			if [ $? -eq 0 ]; then
				echo "pip installation successful, proceeding with installation of requirements"
				pip install -r requirements.txt >/dev/null
			else
				echo "pip installation failed, please install pip manually and then run 'pip3 install -r requirements.txt'"
				exit 1
			fi
		fi
		touch dirsearch
		echo "#!/bin/bash" >>dirsearch
		echo "python3 /opt/dirsearch/dirsearch.py \$*" >>dirsearch
		chmod +x dirsearch
		$SUDO mv dirsearch /usr/bin/
	else
		echo "Installation cancelled."
	fi
else
	echo "dirsearch is already installed"
fi

# AltDNS
if ! command -v altdns &>/dev/null; then
	echo "altdns is not installed."
	if [[ "$install" == 0 ]]; then
		read -p "Do you want to install it? (y / n) : " accepted
	fi
	if [[ "$accepted" == "y" || "$install" == 1 ]]; then
		# check for python3 dont try to install it
		if ! command -v python3 &>/dev/null; then
			echo "python3 is not installed."
			echo "Please install python3 first."
			exit
		fi
		# install dirsearch
		git clone https://github.com/infosec-au/altdns >/dev/null
		# echo "working  : --> ${pwd}"
		$SUDO mv altdns/ /opt/
		cd /opt/altdns/
		# Create a virtual environment
		$SUDO apt install python3-venv >/dev/null
		python3 -m venv venv >/dev/null
		source venv/bin/activate
		# Install the requirements
		# Check if pip is installed ?
		if command -v pip >/dev/null 2>&1; then
			echo "pip is installed, proceeding with installation of requirements"
		else
			echo "pip is not installed, we will install it now"
			# Install pip
			$SUDO apt install -y python3-pip >/dev/null
			# Check if pip installation was successful
			if [ $? -eq 0 ]; then
				echo "pip installation successful, proceeding with installation of requirements"

			else
				echo "pip installation failed, please install pip manually and then run 'pip install -r requirements.txt'"
				exit 1
			fi
		fi
		$SUDO pip install -r requirements.txt >/dev/null
		$SUDO python3 setup.py build >/dev/null
		$SUDO python3 setup.py install >/dev/null
	else
		echo "Installation cancelled."
	fi
else
	echo "altdns is already installed"
fi

# waybackurls using go
if ! command -v waybackurls &>/dev/null; then
	echo "waybackurls is not installed."
	if [[ "$install" == 0 ]]; then
		read -p "Do you want to install it? (y / n) : " accepted
	fi
	if [[ "$accepted" == "y" || "$install" == 1 ]]; then
		# check for golang dont try to install it
		if ! command -v go &>/dev/null; then
			echo "golang is not installed."
			if [[ "$install" == 0 ]]; then
				read -p "Do you want to install it? (y / n) : " accepted
			fi
			if [[ "$accepted" == "y" || "$install" == 1 ]]; then
				$SUDO add-apt-repository ppa:longsleep/golang-backports >/dev/null
				$SUDO apt update >/dev/null
				$SUDO apt install golang-go >/dev/null
			else
				echo "Installation cancelled."
			fi
			# exit 1
		fi
		# install waybackurls
		go install github.com/tomnomnom/waybackurls@latest >/dev/null
		cd $HOME/go/bin
		$SUDO cp waybackurls /usr/bin
	else
		echo "Installation cancelled."
	fi
else
	echo "waybackurls is already installed"
fi

# getallurls (gau) using go
if ! command -v gau &>/dev/null; then
	echo "gau is not installed."
	if [[ "$install" == 0 ]]; then
		read -p "Do you want to install it? (y / n) : " accepted
	fi
	if [[ "$accepted" == "y" || "$install" == 1 ]]; then
		# check for golang dont try to install it
		if ! command -v go &>/dev/null; then
			echo "golang is not installed."
			if [[ "$install" == 0 ]]; then
				read -p "Do you want to install it? (y / n) : " accepted
			fi
			if [[ "$accepted" == "y" || "$install" == 1 ]]; then
				$SUDO add-apt-repository ppa:longsleep/golang-backports >/dev/null
				$SUDO apt update >/dev/null
				$SUDO apt install golang-go >/dev/null
			else
				echo "Installation cancelled."
			fi
			# exit 1
		fi
		# install gau
		go install github.com/lc/gau/v2/cmd/gau@latest >/dev/null
		cd $HOME/go/bin
		$SUDO cp gau /usr/bin
	else
		echo "Installation cancelled."
	fi
else
	echo "gau is already installed"
fi

# gf
if ! command -v gf &>/dev/null; then
	echo "gf is not installed."
	if [[ "$install" == 0 ]]; then
		read -p "Do you want to install it? (y / n) : " accepted
	fi
	if [[ "$accepted" == "y" || "$install" == 1 ]]; then
		# check for golang dont try to install it
		if ! command -v go &>/dev/null; then
			echo "golang is not installed."
			if [[ "$install" == 0 ]]; then
				read -p "Do you want to install it? (y / n) : " accepted
			fi
			if [[ "$accepted" == "y" || "$install" == 1 ]]; then
				$SUDO add-apt-repository ppa:longsleep/golang-backports >/dev/null
				$SUDO apt update >/dev/null
				$SUDO apt install golang-go >/dev/null
			else
				echo "Installation cancelled."
			fi
			# exit 1
		fi
		# install gf
		go install github.com/tomnomnom/gf@latest >/dev/null
		cd $HOME/go/bin
		$SUDO cp gf /usr/bin
	else
		echo "Installation cancelled."
	fi
else
	echo "gf is already installed"
fi
