#!/bin/bash

if [[ $EUID -ne 0 ]]; then
  echo "This script must be run as root."
  exit 1
fi
if [[ $1 == "-h" ]]; then
  echo "Description:"
  echo "  This script sets up the AR4WE tool, ensuring all necessary dependencies"
  echo "  and configurations are properly established for operation."
  echo
  echo "Usage: $0 [options]"
  echo "Options:"
  echo "  -h    Show help message and exit"
  exit 0
fi


if [ "$(id -u)" -eq 0 ]; then
    SUDO=""
else
    SUDO="sudo"
fi


# call checking script
# dont write sudo if the user is already root
if [[ $EUID -ne 0 ]]; then
  $SUDO bash ./checkForTools/checking
else
  bash ./checkForTools/checking
fi

# # Check if the script already exists in /usr/bin
# if [ -f "/usr/bin/AR4WE" ]; then
#   echo "The script AR4WE is already installed in /usr/bin/AR4WE."
# else
# Check if the AR4WE file exists in the current directory before attempting to copy
if [ -f "./AR4WE" ]; then
  echo "Attempting to install AR4WE to /usr/bin..."
  # Copy the script to /usr/bin and change its permissions to executable
  if [[ $EUID -ne 0 ]]; then
    $SUDO cp "./AR4WE" "/usr/bin/AR4WE" && $SUDO chmod +x "/usr/bin/AR4WE"
  else
    cp "./AR4WE" "/usr/bin/AR4WE" && chmod +x "/usr/bin/AR4WE"
  fi
  if [ -f "/usr/bin/AR4WE" ]; then
    echo "AR4WE script successfully installed in /usr/bin/AR4WE."
  else
    echo "Failed to install AR4WE script in /usr/bin/AR4WE."
    exit 1
  fi
else
  echo "AR4WE script not found in the current directory."
  exit 1
fi
# fi

# # and put it in the wordlists directory
mkdir -p /opt/wordlists
mkdir -p /opt/wordlists/dirb

# Check and download the first file if it does not exist
if [ ! -f /opt/wordlists/dirb/common.txt ]; then
  $SUDO wget https://raw.githubusercontent.com/cujanovic/dirsearch-wordlist/master/serbian-english-wordlist-final-dirsearch-format-with-ext.txt -O /opt/wordlists/dirb/common.txt
else
  echo "File /opt/wordlists/dirb/common.txt already exists, not downloading to avoid overwriting."
fi

# Check and download the second file if it does not exist
if [ ! -f /opt/wordlists/subSub.txt ]; then
  $SUDO wget https://wordlists-cdn.assetnote.io/data/automated/httparchive_subdomains_2024_04_28.txt -O /opt/wordlists/subSub.txt
else
  echo "File /opt/wordlists/subSub.txt already exists, not downloading to avoid overwriting."
fi

# download this wordlist : https://raw.githubusercontent.com/cujanovic/dirsearch-wordlist/master/serbian-english-wordlist-final-dirsearch-format-with-ext.txt
